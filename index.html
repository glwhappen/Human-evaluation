<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Evaluation</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/prismjs/themes/prism-tomorrow.css" rel="stylesheet"> <!-- Choose a theme that fits your needs -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>

    <style>
        .code {
            background-color: #f5f5f5;
            border-left: 4px solid rgb(230, 90, 15);
            padding: 0.5rem 1rem;
            overflow: auto;
        }
    </style>
</head>
<body>
    <div id="app" class="container mt-5">
        <div v-if="currentCode">
            <div class="mb-3">
                <h3>数量: {{currentCodeIndex}} / {{ codes.length }}</h3>
                <h3>待补全代码</h3>
                <pre class="code"><code>{{ currentCode.row_code }}</code></pre>
                <h3>参考代码{{C}}</h3>
                <pre class="code"><code>{{ currentCode[C] }}</code></pre>
                <h3>参考代码{{D}}</h3>
                <pre class="code"><code>{{ currentCode[D] }}</code></pre>
            </div>
            <h3>补全结果A:</h3>
            <pre class="code"><code>{{ currentCode[A] }}</code></pre>

            <!-- <label>你认为A代码的【正确性】&#12288;分数 (1-3):</label>
            <div class="btn-group" role="group">
                <template v-for="number in [1, 2, 3]">
                    <input type="radio" class="btn-check" v-model="correctness[A]" :id="`correctness-A-${number}`" :value="number">
                    <label class="btn btn-outline-primary" :for="`correctness-A-${number}`">{{number}}</label>
                </template>
            </div>
            <br>

            <label>你认为A代码的【可维护性】分数 (1-3):</label>
            <div class="btn-group" role="group">
                <template v-for="number in [1, 2, 3]">
                    <input type="radio" class="btn-check" v-model="maintainability[A]" :id="`maintainability-A-${number}`" :value="number">
                    <label class="btn btn-outline-primary" :for="`maintainability-A-${number}`">{{number}}</label>
                </template>
            </div>
            <br>
            <label>你认为A代码的【可读性】&#12288;分数 (1-3):</label>
            <div class="btn-group" role="group">
                <template v-for="number in [1, 2, 3]">
                    <input type="radio" class="btn-check" v-model="readability[A]" :id="`readability-A-${number}`" :value="number">
                    <label class="btn btn-outline-primary" :for="`readability-A-${number}`">{{number}}</label>
                </template>
            </div>
            <br> -->

            <h3>补全结果B:</h3>
            <pre class="code">{{ currentCode[B] }}</pre>
            <label>【正确性】&#12288;:</label>
            <div class="btn-group" role="group">

                <input type="radio" class="btn-check" v-model="correctness" :id="`correctness-A`" value="1">
                <label class="btn btn-outline-primary" :for="`correctness-A`">A代码更好</label>
                <input type="radio" class="btn-check" v-model="correctness" :id="`correctness-A-B`" value="2">
                <label class="btn btn-outline-primary" :for="`correctness-A-B`">平局</label>
                <input type="radio" class="btn-check" v-model="correctness" :id="`correctness-B`" value="3">
                <label class="btn btn-outline-primary" :for="`correctness-B`">B代码更好</label>

            </div>
            <br>
            <label>你认为B代码的【可维护性】分数 (1-3):</label>
            <div class="btn-group" role="group">
                <template v-for="number in [1, 2, 3]">
                    <input type="radio" class="btn-check" v-model="maintainability[B]" :id="`maintainability-B-${number}`" :value="number">
                    <label class="btn btn-outline-primary" :for="`maintainability-B-${number}`">{{number}}</label>
                </template>
            </div>
            <br>

            <label>你认为B代码的【可读性】&#12288;分数 (1-3):</label>
            <div class="btn-group" role="group">
                <template v-for="number in [1, 2, 3]">
                    <input type="radio" class="btn-check" v-model="readability[B]" :id="`readability-B-${number}`" :value="number">
                    <label class="btn btn-outline-primary" :for="`readability-B-${number}`">{{number}}</label>
                </template>
            </div>
            <br>

            <button class="btn btn-primary" @click="submitRating">提交</button>
            <!-- <p>请从上面的两份代码中，分别给代码进行打分，打分规则如下：</p> -->
        </div>
        <div v-else>
            <h2>填写结束</h2>
            <br>
            填表结束，请复制下面的内容发送给glw，然后来换取红包，谢谢 <br>
            <textarea rows="10" cols="50">{{JSON.stringify(result)}}</textarea>

        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/prismjs/prism.js"></script> <!-- Prism JS -->
    <script>
        new Vue({
            el: '#app',
            data: {
                codes: [], // Your JSON data here
                currentCodeIndex: 0,
                currentCode: null,
                A: "openai",
                B: "selecter",
                C: "right_line",
                D: "huge_line",
                rating: {
                    "openai": 5,
                    "selecter": 5
                },
                correctness: null,
                maintainability: {
                    "openai": null,
                    "selecter": null
                },
                readability: {
                    "openai": null,
                    "selecter": null
                },
                result: {}
            },
            mounted() {
                // Fetch data from your API endpoint
                fetch('http://linux.glwsq.cn:7124/api/data')
                    .then(response => response.json())
                    .then(data => {
                        this.codes = data;
                        this.currentCode = this.codes[this.currentCodeIndex];
                        this.swap()
                    });
            },
            methods: {
                swap() {
                    if (Math.random() < 0.5) {
                        [this.A, this.B] = [this.B, this.A];
                    }
                    if (Math.random() < 0.5) {
                        [this.C, this.D] = [this.D, this.C];
                    }
                },
                submitRating() {
                    function areAllValuesNonNull(correctness, maintainability, readability) {
                        // 获取所有对象的值并合并到一个数组中
                        const allValues = [
                            ...Object.values(correctness),
                            ...Object.values(maintainability),
                            ...Object.values(readability)
                        ];

                        // 检查数组中的每个值是否都不为null
                        return allValues.every(value => value !== null);
                    }
                    if (areAllValuesNonNull(this.correctness, this.maintainability, this.readability)) {
                        // this.currentCode.key = this.rating; // Save the rating in the key field

                        this.currentCodeIndex++;
                        if (this.currentCodeIndex < this.codes.length) {
                            this.currentCode = this.codes[this.currentCodeIndex];
                            this.swap()
                            this.result[this.currentCode.key] = {
                                correctness: this.correctness,
                                maintainability: this.maintainability,
                                readability: this.readability
                            }
                            this.correctness = {
                                "openai": null,
                                "selecter": null
                            }
                                    this.maintainability = {
                                "openai": null,
                                "selecter": null
                            }
                                    this.readability = {
                                "openai": null,
                                "selecter": null
                            }

                        } else {
                            this.currentCode = null; // No more codes to rate
                        }
                        
                    } else {
                        alert('请打分后继续');
                    }
                }
            }
        });
    </script>
    
</body>
</html>
